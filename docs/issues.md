# GES UI 组件库 问题记录

本文件记录组件库开发过程中遇到的问题及其修复方法。

## 表单组件

### Input Tag 组件

#### 1. 递归更新问题

**问题描述**：删除标签时会报错 "Maximum recursive updates exceeded in component <input-tag>"

**问题原因**：在 removeTag 函数中，代码同时通过 watch 和显式调用两种方式触发了 update:modelValue 事件，导致递归更新。

**修复方案**：修改 watch 函数，避免在值相同时触发重复更新，只在值实际变化时再触发 update:modelValue 事件。

**修复时间**：2024-07-12

**状态**：已修复

#### 2. 标签颜色配置

**问题描述**：需要支持配置 ui-tag 的颜色

**修复方案**：添加动态设置Tag颜色的工具函数，基于索引或Tag内容生成不同颜色，支持通过tagColor、tagBgColor和tagTextColor属性自定义颜色。

**修复时间**：2024-07-13

**状态**：已完成

### Autocomplete 组件

#### 1. 下拉框闪现问题

**问题描述**：选择下拉框内容后下拉框会闪现一下

**问题原因**：在选择选项后，组件未防止处理 blur 事件时重新打开下拉框，且多个处理选项选择的方法实现不一致

**修复方案**：

1. 改进 ignoreBlurEvent 标记的使用，确保在选项点击时立即设置
2. 修改 handleBlur 方法，在 ignoreBlurEvent 为 true 时不关闭下拉框
3. 统一 handleOptionClick 和 selectOption 的实现逻辑

**修复时间**：2024-07-12

**状态**：已修复

#### 2. 选项分组高亮错乱问题

**问题描述**：选项分组时鼠标放到一个选项时另一个分组的也会高亮

**问题原因**：选项的key值可能重复，导致Vue无法正确区分不同选项

**修复方案**：确保每个选项使用唯一的key，包括组索引、选项值和选项索引

**修复时间**：2024-07-12

**状态**：已修复

#### 3. 选中选项后下拉框为空问题

**问题描述**：选中一个选项后，再次展开下拉框时内容为空

**问题原因**：选项过滤逻辑有问题，没有正确处理空输入值和分组选项的情况

**修复方案**：重构filteredOptions和finalOptions计算属性，优化选项过滤和分组处理逻辑

**修复时间**：2024-07-13

**状态**：已修复

### Cascader 级联选择器

#### 1. 下拉框关闭问题

**问题描述**：选择有子节点的节点时不应关闭下拉框

**问题原因**：在选择任何节点后都会直接关闭下拉框，而不是仅在选择叶子节点时关闭

**修复方案**：修改为鼠标悬停就展开子节点，单击才是选中，仅在选中叶子节点时才关闭下拉框

**修复时间**：2024-07-13

**状态**：已修复

#### 2. 滚动条问题

**问题描述**：下拉框内容超出时没有出现滚动条导致无法选中

**问题原因**：缺少必要的CSS样式设置overflow和最大高度

**修复方案**：为级联选择器面板添加overflow-y: auto和max-height样式，确保超出内容可以滚动查看

**修复时间**：2024-07-12

**状态**：已修复

#### 3. 叶子节点回显问题

**问题描述**：选中叶子节点时没有回显，选中时候下拉框就隐藏了

**问题原因**：在选中节点后立即关闭下拉框，没有正确更新选中状态

**修复方案**：修改选中逻辑，确保在关闭下拉框前正确更新选中值并触发相应事件

**修复时间**：2024-07-12

**状态**：已修复

### ColorPicker 颜色选择器

#### 1. 颜色选择问题

**问题描述**：带透明度时无法选中颜色，值变成rgba(NaN, NaN, NaN, 0.5)这种无效值

**问题原因**：颜色转换函数实现有误，未正确处理HSL/RGB/HEX格式转换和透明度

**修复方案**：

1. 重写颜色转换函数，修复HSL到RGB和HEX的转换
2. 修复拖动逻辑，确保正确计算和更新颜色值
3. 优化值格式化，确保生成有效的颜色字符串

**修复时间**：2024-07-13

**状态**：已修复

### TimePicker 时间选择器

#### 1. 下拉框关闭问题

**问题描述**：选择时间后立即关闭下拉框，应该点击确定按钮时才关闭

**问题原因**：在设置时间值时就关闭了面板，而不是等用户确认

**修复方案**：修改时间设置函数，移除直接关闭面板的代码，仅在点击确认按钮时才关闭面板

**修复时间**：2024-07-13

**状态**：已修复

### Upload 上传组件

#### 1. Demo缺失问题

**问题描述**：Upload组件已实现但未添加到组件演示页面中

**问题原因**：在实现Upload组件后，未更新组件演示页面

**修复方案**：将Upload组件添加到组件演示页面的表单组件分组中

**修复时间**：2024-07-17

**状态**：已修复

## 布局组件

### Split 面板分割

#### 1. 拖动位置问题

**问题描述**：分割位置的值没有随拖动发生变化

**问题原因**：未在拖动过程中更新modelValue，只在拖动结束时更新了一次

**修复方案**：在handleDragMove函数中实时更新modelValue值，确保拖动过程中能够反映当前分割位置

**修复时间**：2024-07-13

**状态**：已修复

#### 2. 最小尺寸限制问题

**问题描述**：最小尺寸限制不生效

**问题原因**：最小尺寸限制的实现有误，未正确应用props.min属性

**修复方案**：修复最小尺寸限制的逻辑，确保每个面板至少有min%的空间

**修复时间**：2024-07-13

**状态**：已修复

#### 3. 分隔条样式问题

**问题描述**：拖动到最右边后拖动元素消失，导致无法继续拖动

**问题原因**：分隔条的z-index设置不正确，被其他元素覆盖或位置计算错误

**修复方案**：增加分隔条的z-index值，确保始终保持在前，优化样式以保证可见性，修复宽度/高度计算

**修复时间**：2024-07-13

**状态**：已修复

### Collapse 折叠面板

#### 1. 嵌套面板溢出问题

**问题描述**：嵌套面板时，里面嵌套的折叠面板超出了外层内容区

**问题原因**：缺少必要的overflow:hidden样式和盒模型设置

**修复方案**：

1. 为内容区添加overflow:hidden样式
2. 设置width:100%和box-sizing:border-box确保内容不会溢出
3. 为嵌套的折叠面板添加特定样式以确保正确显示

**修复时间**：2024-07-13

**状态**：已修复

## 数据展示组件

### Table 表格组件

#### 1. 排序箭头点击问题

**问题描述**：排序的两个箭头点击没反应，并且点击一个两个都会被高亮

**问题原因**：

1. 表格组件使用了单一图标表示排序状态，而不是分开的上下箭头
2. 排序状态切换逻辑只在点击整个单元格时生效，没有为单独的箭头添加点击事件

**修复方案**：

1. 将单一排序图标拆分为独立的上下箭头
2. 为每个箭头添加独立的点击事件处理函数，直接设置对应的排序状态
3. 修改排序状态切换逻辑，支持直接指定排序方向

**修复时间**：2024-07-17

**状态**：已修复

#### 2. 表格滚动条问题

**问题描述**：页面宽度发生变化时表格未显示滚动条，导致部分内容不可见

**问题原因**：

1. 表格容器的overflow样式设置不正确
2. 表格主体没有设置最小宽度

**修复方案**：

1. 为表格容器添加overflow:hidden样式
2. 为表格主体添加overflow:auto样式以显示滚动条
3. 为表格设置min-width:100%确保内容不会被压缩

**修复时间**：2024-07-17

**状态**：已修复

#### 3. 单元格tooltip问题

**问题描述**：单元格内容过长显示省略号时，没有tooltip显示完整内容

**问题原因**：虽然添加了showOverflowTooltip属性，但未实现实际的tooltip功能

**修复方案**：

1. 为带有showOverflowTooltip属性的单元格添加title属性，值为完整的单元格内容
2. 添加CSS实现鼠标悬停时显示tooltip的效果

**修复时间**：2024-07-17

**状态**：已修复

#### 4. 排序箭头功能和间距问题

**问题描述**：排序箭头点击没有实际排序效果，并且上下间距过大

**问题原因**：

1. 排序功能只改变了排序状态而没有实际执行排序操作
2. 箭头图标之间的间距样式设置不合理

**修复方案**：

1. 修改排序处理逻辑，支持点击切换排序状态和取消排序
2. 在演示组件中实现真实的数据排序功能响应排序事件
3. 调整排序图标的样式，减小上下间距，设置合适的padding和字体大小
4. 添加line-height:0来消除额外的行距

**修复时间**：2024-07-18

**状态**：已修复

### Rate 评分组件

#### 1. 图标加载问题

**问题描述**：无法加载图标，报错"[Icon] failed to load icon `carbon:heart-filled`"

**问题原因**：使用了不存在的或不可用的图标名称

**修复方案**：将图标从'carbon:heart-filled'更改为可用的'mdi:heart'和'mdi:heart-outline'图标

**修复时间**：2024-07-16

**状态**：已修复

### OverflowList 折叠列表

#### 1. "更多"元素显示不全问题

**问题描述**：宽度变化时，自定义样式的"更多"元素显示不全，部分内容被截断

**问题原因**：

1. "更多"按钮宽度计算不准确，未考虑自定义样式的影响
2. 缺少必要的填充空间和内边距
3. 未做好溢出处理

**修复方案**：

1. 改进"更多"按钮宽度计算方法，使用getBoundingClientRect代替offsetWidth
2. 为计算结果添加额外的边距(+10px)确保完全显示
3. 添加padding和box-sizing:border-box确保内容不会被截断
4. 为"更多"按钮添加white-space:nowrap防止文本换行

**修复时间**：2024-07-19

**状态**：已修复

#### 2. 点击"更多"按钮功能问题

**问题描述**：点击"更多"按钮没有显示所有隐藏的项目，只触发了事件但无实际功能

**问题原因**：

1. 组件仅提供了点击事件，但没有内置展开功能的实现
2. 默认expandOnClick属性为false，导致演示中点击不展开
3. "更多"按钮与列表项共用同一个布局容器，影响布局计算

**修复方案**：

1. 添加expandOnClick属性，支持点击展开所有项目
2. 实现展开/收起状态切换逻辑
3. 优化"更多"按钮的样式，增加展开状态的视觉反馈
4. 在所有演示用例中启用expandOnClick属性
5. 完全重构组件布局，将"更多"按钮从列表项容器中分离出来
6. 为"更多"按钮添加flex-none属性确保其不参与弹性布局收缩

**修复时间**：2024-07-19

**修复更新**：2024-07-20 - 重构布局确保"更多"按钮始终显示完整

**状态**：已修复

#### 3. 最小显示宽度问题

**问题描述**：缺少最小显示宽度约束，导致当容器宽度较窄时，项目元素显示不全

**问题原因**：未对列表项设置最小宽度限制，在空间不足时会过度压缩项目

**修复方案**：

1. 添加minItemWidth属性，支持设置列表项的最小宽度
2. 在CSS中添加overflow:hidden和text-overflow:ellipsis处理溢出文本
3. 为列表项添加样式绑定，支持动态设置最小宽度
4. 监听minItemWidth属性变化，及时重新计算显示项

**修复时间**：2024-07-19

**状态**：已修复

#### 4. "收起"按钮样式问题

**问题描述**："收起"按钮样式简陋，缺乏视觉反馈和交互感

**问题原因**：

1. 缺少适当的视觉设计，如背景色、边框、图标等
2. 未添加交互状态样式，如悬停效果
3. 文本直接硬编码，不支持自定义

**修复方案**：

1. 优化按钮样式，添加内边距、边框圆角和背景色
2. 添加图标提示（上/下箭头）增强视觉指引
3. 增加悬停效果和过渡动画提升交互体验
4. 添加collapseText属性支持自定义"收起"文本
5. 提供插槽自定义完整的按钮内容，包含展开/收起状态

**修复时间**：2024-07-20

**状态**：已修复

#### 5. 展开项目滚动问题

**问题描述**：展开后如果项目较多，超出屏幕部分无法通过滚动查看

**问题原因**：

1. 展开后的容器未设置适当的overflow样式
2. 未考虑项目数量过多的情况

**修复方案**：

1. 为展开状态的容器添加overflow-y:auto样式
2. 优化展开项的高度处理，确保内容不会超出屏幕
3. 改进布局结构，使滚动区域仅限于内容部分而非整个组件

**修复时间**：2024-07-20

**状态**：已修复

#### 6. 垂直方向展示功能

**问题描述**：组件仅支持水平方向的折叠列表，无法满足垂直列表的需求

**问题原因**：未考虑到垂直布局的使用场景，如文章列表、评论列表等

**修复方案**：

1. 添加direction属性，支持'horizontal'和'vertical'两种布局方向
2. 为垂直布局添加特定的样式和布局逻辑
3. 添加maxHeight属性控制垂直列表的最大高度
4. 实现垂直方向的溢出计算逻辑
5. 添加垂直方向的演示示例

**修复时间**：2024-07-20

**状态**：已完成

#### 7. 水平方向按钮样式和展开效果问题

**问题描述**：

1. 水平方向的"更多"和"收起"按钮样式不够美观
2. 水平方向展开后内容不完整，无法查看所有项目

**问题原因**：

1. 按钮样式未使用系统主题色，视觉效果不佳
2. 水平方向展开时未实现内容换行，导致部分内容仍然隐藏

**修复方案**：

1. 优化按钮样式，使用系统主题色变量
2. 添加图标增强按钮视觉效果
3. 实现水平方向展开时的内容换行(flex-wrap: wrap)
4. 改进水平布局的展示逻辑，确保展开后所有内容可见
5. 更新演示组件，展示改进后的效果

**修复时间**：2024-07-20

**状态**：已修复

## Demo演示页面

### 1. 滚动逻辑问题

**问题描述**：左侧菜单和内容区滚动逻辑未分开，导致内容区滚动时菜单也会滚动

**问题原因**：页面布局结构导致整个页面共用一个滚动条

**修复方案**：

1. 将左侧菜单固定定位(fixed)，使其不随内容区滚动
2. 添加一个占位元素，确保内容区域不被固定定位的菜单遮挡
3. 保持左侧菜单自身的滚动功能，允许在菜单项过多时单独滚动

**修复时间**：2024-07-17

**状态**：已修复
